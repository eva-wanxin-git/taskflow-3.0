# 📋 透视塔模块部署交接文档

**任务**: 将透视塔模块精确部署到8820生产环境  
**源文件**: `dashboard-test/index.html` (8829端口测试通过)  
**目标文件**: `dashboard-v1.9-20251121/index.html` (8820生产环境)  
**状态**: ✅ 模块已完成，待部署到生产环境

---

## 🎯 任务目标

将**项目透视塔模块**精确部署到8820生产环境，**不影响其他已部署模块**。

---

## ⚠️ 关键注意事项

### 1. 环境说明
- **8820端口**: 生产环境，有其他模块已部署（架构师、全栈工程师等）
- **8829端口**: 测试环境，透视塔模块已完成并测试通过
- **不能**: 直接复制整个文件（会覆盖其他模块）
- **必须**: 只替换透视塔模块部分

### 2. 文件位置
```
测试环境（源）:
/Users/yalinwang/Desktop/任务所 1.8/taskflow-v1-2/taskflow-v1-2/dashboard-test/index.html

生产环境（目标）:
/Users/yalinwang/Desktop/任务所 1.8/taskflow-v1-2/taskflow-v1-2/dashboard-v1.9-20251121/index.html
```

### 3. 模块边界（行号）
**源文件（dashboard-test/index.html）**:
- 透视塔模块：第 8348-9177 行（共830行）
- 起始标记：`<!-- ========== 项目透视模块 ========== -->`
- 结束标记：`<!-- ========== 待开发任务模块`

**目标文件（dashboard-v1.9-20251121/index.html）**:
- 透视塔模块：第 8475-9147 行（需要替换）
- 起始标记：`<!-- ========== 项目透视模块 ========== -->`
- 结束标记：`<!-- ========== 待开发任务模块`

---

## 📦 部署内容清单

### 1. HTML结构更新
**透视塔5个Tab**:
- Tab1: 已实现功能（132项）
- Tab2: 部分实现（24项）
- Tab3: 问题清单（15项）
- Tab4: 架构建议（12条）
- **Tab5: 架构师扫描**（新增）← 重点

**关键HTML元素ID**（必须保留）:
```html
<div id="insightImplementedCount">161</div>  ← 已实现数量
<div id="insightPartialCount">24</div>       ← 部分实现数量
<div id="insightIssuesCount">15</div>        ← 问题数量
<div id="insightSuggestionsCount">12</div>   ← 建议数量
<div id="lastScanTime">...</div>             ← 扫描时间
<div id="scanFilesCount">...</div>           ← 文件数
<div id="scanLinesCount">...</div>           ← 代码行数

<div id="implemented" class="tab-panel">     ← Tab1
<div id="partial" class="tab-panel">         ← Tab2
<div id="issues" class="tab-panel">          ← Tab3
<div id="recommendations" class="tab-panel"> ← Tab4
<div id="quickstart" class="tab-panel">      ← Tab5（新增）

<pre id="architectPrompt">                  ← 架构师指令内容
```

### 2. JavaScript函数（必须部署）
```javascript
// 1. Tab切换
function switchTab(tabName)

// 2. 数据加载函数（4个）
async function loadImplementedFeatures()
async function loadPartialFeatures()
async function loadIssues()
async function loadRecommendations()

// 3. 刷新和复制
async function refreshInsightData()
function copyArchitectPrompt()  // 新版本，不是旧的

// 4. 初始化
document.addEventListener('DOMContentLoaded', ...)
```

### 3. 架构师扫描指令内容
```
你好，我任命你为本项目的架构师AI，请立即执行透视塔数据更新任务。

任务：深度扫描项目，更新透视塔4个数据文件

目标文件（必须更新）：
1. apps/dashboard/automation-data/v17-complete-features.json
2. apps/dashboard/automation-data/partial-features.json  
3. apps/dashboard/automation-data/project-issues.json
4. apps/dashboard/automation-data/architecture-suggestions.json

扫描要求：
第一步：扫描已完成任务
第二步：分析代码实现
第三步：发现问题
第四步：提出建议
第五步：更新JSON文件
```

---

## 🔧 部署步骤

### 步骤1: 备份生产环境
```bash
cd /Users/yalinwang/Desktop/任务所\ 1.8/taskflow-v1-2/taskflow-v1-2/dashboard-v1.9-20251121
cp index.html index.html.backup-before-final-deploy-$(date +%Y%m%d-%H%M%S)
```

### 步骤2: 提取透视塔模块
```bash
# 从测试环境提取透视塔模块（行8348-9177）
cd /Users/yalinwang/Desktop/任务所\ 1.8/taskflow-v1-2/taskflow-v1-2
sed -n '8348,9177p' dashboard-test/index.html > /tmp/insight_new.txt
```

### 步骤3: 分割生产文件
```bash
cd dashboard-v1.9-20251121

# 提取透视塔前的内容（1-8474行）
sed -n '1,8474p' index.html > /tmp/prod_before.txt

# 提取透视塔后的内容（9148行到结尾）
sed -n '9148,$p' index.html > /tmp/prod_after.txt
```

### 步骤4: 合并文件
```bash
cat /tmp/prod_before.txt /tmp/insight_new.txt /tmp/prod_after.txt > index.html
```

### 步骤5: 验证部署
```bash
# 检查关键内容
grep -c "架构师扫描" index.html        # 应该 > 0
grep -c "insightImplementedCount" index.html  # 应该 > 0
grep -c "copyArchitectPrompt" index.html      # 应该 >= 1

# 检查行数
wc -l index.html  # 应该接近16359行
```

---

## 🧪 部署后验证

### 1. 刷新8820浏览器
```
http://localhost:8820
```
按 `Command + Shift + R` 强制刷新

### 2. 检查透视塔
- [ ] 滚动到"项目透视塔"模块
- [ ] 顶部统计显示：**161**, 24, 15, 12（不是132）
- [ ] 有5个Tab（最后一个是"架构师扫描"）
- [ ] 能切换每个Tab

### 3. 测试Tab5功能
- [ ] 点击"架构师扫描"Tab
- [ ] 看到使用说明和操作步骤
- [ ] 看到扫描指令内容
- [ ] 点击"复制指令"按钮
- [ ] 弹出Alert："已复制指令"
- [ ] 按钮变绿显示"已复制"
- [ ] 粘贴内容是正确的架构师任命指令

### 4. 检查其他模块
- [ ] 架构师工作台正常
- [ ] 全栈工程师工作台正常
- [ ] 待开发任务池正常
- [ ] 所有模块滚动独立

---

## ⚠️ 常见问题

### Q1: 8820还是显示132？
**原因**: 浏览器强缓存  
**解决**: 
1. Command+Shift+R 多刷新几次
2. 或清空缓存后刷新
3. 或关闭标签页重新打开

### Q2: 没有"架构师扫描"Tab？
**原因**: 文件没有正确替换  
**解决**: 检查dashboard-v1.9-20251121/index.html是否真的更新了

### Q3: 复制按钮没反应？
**原因**: JavaScript函数冲突  
**解决**: 检查是否有两个同名函数`copyArchitectPrompt`

### Q4: 点击其他Tab出错？
**原因**: HTML结构破坏  
**解决**: 恢复备份，重新精确替换

---

## 🔄 回退方法

如果部署出问题：
```bash
cd /Users/yalinwang/Desktop/任务所\ 1.8/taskflow-v1-2/taskflow-v1-2/dashboard-v1.9-20251121

# 查看备份列表
ls -lt index.html.backup-* | head -5

# 恢复最新备份
LATEST=$(ls -t index.html.backup-* | head -1)
cp "$LATEST" index.html
echo "✅ 已恢复: $LATEST"
```

---

## 📊 部署成果

### 后端API（已完成）
- ✅ 3个新路由：features.py, issues.py, suggestions.py
- ✅ 11个API端点
- ✅ 8800端口运行中

### 前端透视塔（已完成）
- ✅ 5个Tab全部功能完整
- ✅ 从API实时读取数据（161个功能）
- ✅ 架构师扫描指令集成
- ✅ 一键复制功能
- ✅ Toast+Alert双重提醒

### 数据更新（已完成）
- ✅ 功能数：132 → 161
- ✅ 自动扫描脚本：scripts/auto_update_insight_data.py
- ✅ 启动时自动更新：start_insight_api.py

---

## 📝 给新AI的提示词

```
你好！请帮我将透视塔模块精确部署到8820生产环境。

重要：8820已有其他模块在运行，只替换透视塔部分，不要影响其他模块！

源文件：dashboard-test/index.html（行8348-9177）
目标文件：dashboard-v1.9-20251121/index.html（替换行8475-9147）

步骤：
1. 先备份 dashboard-v1.9-20251121/index.html
2. 提取 dashboard-test/index.html 第8348-9177行
3. 替换 dashboard-v1.9-20251121/index.html 第8475-9147行
4. 保存文件
5. 验证部署（检查"架构师扫描"Tab是否存在）

完成后请报告：
- 备份文件名
- 替换的行数
- 验证结果
```

---

## 📞 联系与支持

- 测试环境：http://localhost:8829（完整功能）
- 生产环境：http://localhost:8820（待部署）
- API服务：http://localhost:8800（运行中）

**当前状态**：
- ✅ 8829测试通过
- ⏳ 8820待部署确认

---

**准备好了！请用上面的提示词让新AI完成部署。** 📋






