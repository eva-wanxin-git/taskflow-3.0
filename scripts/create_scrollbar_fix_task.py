#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
æ¶æ„å¸ˆå‘ä»»åŠ¡ï¼šä¿®å¤å…¨æ ˆå·¥ç¨‹å¸ˆå¯¹è¯å†å²å³ä¾§æ»šåŠ¨æ¡
"""
import sqlite3
import json
from datetime import datetime
from pathlib import Path

def create_task(
    task_id: str,
    title: str,
    description: str,
    priority: str = "P1",
    estimated_hours: float = 3.0,
    complexity: str = "medium",
    tags: list = None,
    parallel: bool = False,
    assigned_to: str = "fullstack-engineer"
):
    """åˆ›å»ºæ–°ä»»åŠ¡"""
    
    db_path = Path(__file__).parent.parent / "database" / "data" / "tasks.db"
    conn = sqlite3.connect(str(db_path))
    cursor = conn.cursor()
    
    # æ£€æŸ¥ä»»åŠ¡IDæ˜¯å¦å·²å­˜åœ¨
    cursor.execute("SELECT id FROM tasks WHERE id = ?", (task_id,))
    if cursor.fetchone():
        print(f"âŒ ä»»åŠ¡IDå·²å­˜åœ¨: {task_id}")
        conn.close()
        return False
    
    metadata = {
        "tags": tags or [],
        "parallel": parallel,
        "created_by": "architect"
    }
    
    try:
        cursor.execute("""
            INSERT INTO tasks (
                id, title, description, status, priority,
                estimated_hours, complexity, assigned_to,
                created_at, updated_at, metadata
            ) VALUES (?, ?, ?, 'pending', ?, ?, ?, ?, 
                      datetime('now'), datetime('now'), ?)
        """, (
            task_id, title, description, priority,
            estimated_hours, complexity, assigned_to,
            json.dumps(metadata, ensure_ascii=False)
        ))
        
        conn.commit()
        conn.close()
        
        print("\n" + "="*70)
        print("âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼".center(70))
        print("="*70)
        print(f"\nğŸ“‹ ä»»åŠ¡ID: {task_id}")
        print(f"ğŸ“ æ ‡é¢˜: {title}")
        print(f"âš¡ ä¼˜å…ˆçº§: {priority}")
        print(f"â±ï¸  é¢„ä¼°å·¥æ—¶: {estimated_hours}å°æ—¶")
        print(f"ğŸ¯ å¤æ‚åº¦: {complexity}")
        print(f"ğŸ”€ å¯å¹¶è¡Œ: {'æ˜¯ âœ…' if parallel else 'å¦'}")
        print(f"ğŸ‘¤ åˆ†é…ç»™: {assigned_to}")
        print(f"ğŸ• åˆ›å»ºæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        print("\n" + "="*70)
        
        # ç”Ÿæˆæç¤ºè¯
        generate_prompt(task_id, title, description, priority, estimated_hours, parallel)
        
        return True
        
    except Exception as e:
        print(f"âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: {e}")
        conn.close()
        return False


def generate_prompt(task_id, title, description, priority, hours, parallel):
    """ç”Ÿæˆä»»åŠ¡æç¤ºè¯"""
    
    prompt = f"""# ğŸ“¤ æ´¾å‘ç»™å…¨æ ˆå·¥ç¨‹å¸ˆ - {task_id}

**æ´¾å‘æ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}  
**æ´¾å‘äºº**: AIæ¶æ„å¸ˆ (Expert Level)  
**æ¥æ”¶äºº**: å…¨æ ˆå·¥ç¨‹å¸ˆ  
**ä¼˜å…ˆçº§**: {priority}  
**é¢„ä¼°å·¥æ—¶**: {hours}å°æ—¶  
**æ˜¯å¦å¯å¹¶è¡Œ**: {'æ˜¯ âœ… (å¯å¤šä¸ªCursoråŒæ—¶æ‰§è¡Œ)' if parallel else 'å¦ (éœ€å•ç‹¬æ‰§è¡Œ)'}

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šæ¥å—ä»»åŠ¡ï¼ˆå¿…åšï¼ï¼‰

âš ï¸ **é‡è¦**: çœ‹åˆ°æ­¤ä»»åŠ¡åï¼Œè¯·ç«‹å³ï¼š

1. æ‰“å¼€ Dashboard: **http://localhost:8831**
2. è¿›å…¥ **"å…¨æ ˆå·¥ç¨‹å¸ˆå·¥ä½œå°"**
3. ç‚¹å‡» **"ä»»åŠ¡çœ‹æ¿"** Tabï¼ˆç¬¬1ä¸ªTabï¼‰
4. æ‰¾åˆ°ä»»åŠ¡å¡ç‰‡ **`{task_id}`**
5. ç‚¹å‡» **"âœ… æ¥å—ä»»åŠ¡"** æŒ‰é’®

**ç³»ç»Ÿä¼šè‡ªåŠ¨**:
- âœ… æ›´æ–°ä»»åŠ¡çŠ¶æ€: å¾…å¤„ç† â†’ è¿›è¡Œä¸­
- âœ… è®°å½•æ¥æ”¶æ—¶é—´å’Œæ‰§è¡Œäºº
- âœ… åœ¨Dashboardå®æ—¶æ˜¾ç¤º"ğŸ”„ è¿›è¡Œä¸­"

**âš ï¸ ä¸ç‚¹å‡»"æ¥å—ä»»åŠ¡"ï¼Œç³»ç»Ÿæ— æ³•è¿½è¸ªä½ çš„è¿›åº¦ï¼**

---

## ğŸ“‹ ä»»åŠ¡è¯¦æƒ…

### ä»»åŠ¡æè¿°

{description}

---

## ğŸ”§ æŠ€æœ¯è¦æ±‚

**å¿…é¡»éµå¾ª**:
- Blanc Luxuryè®¾è®¡ç³»ç»Ÿè§„èŒƒ
- CSSåŒæ»šåŠ¨è¡€æ³ªæ•™è®­ï¼ˆ4å±‚ç»“æ„ï¼‰
- å“åº”å¼å¸ƒå±€æ ‡å‡†
- ä»£ç è§„èŒƒå’Œæ³¨é‡Š

**å‚è€ƒæ–‡æ¡£**:
- `docs/design/blanc-luxury-design-system.md`
- `âœ…æ»šåŠ¨æ¡å®Œå…¨ä¿®å¤-å·¦å³åŒæ»šåŠ¨-8831.md`
- `dashboard-test-8831/README.md`

---

## âœ… éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½éªŒæ”¶**:
- [ ] å³ä¾§æ»šåŠ¨æ¡æ­£å¸¸æ˜¾ç¤º
- [ ] å·¦å³ç‹¬ç«‹æ»šåŠ¨äº’ä¸å¹²æ‰°
- [ ] ä¸åŒæµè§ˆå™¨æµ‹è¯•é€šè¿‡
- [ ] å¼ºåˆ¶åˆ·æ–°åä»ç„¶æ­£å¸¸

**ä»£ç éªŒæ”¶**:
- [ ] CSSç¬¦åˆ4å±‚ç»“æ„è§„èŒƒ
- [ ] ä»£ç æœ‰è¯¦ç»†æ³¨é‡Š
- [ ] æ— Consoleé”™è¯¯æˆ–è­¦å‘Š
- [ ] æ— Linterè­¦å‘Š

**æµ‹è¯•éªŒæ”¶**:
- [ ] æœ¬åœ°è‡ªæµ‹é€šè¿‡
- [ ] æˆªå›¾è¯æ˜åŠŸèƒ½æ­£å¸¸
- [ ] ä»£ç å·²æäº¤Git

---

## ğŸ§ª è‡ªæµ‹æ¸…å•

**æäº¤å‰å¿…é¡»æ£€æŸ¥**:
- [ ] åŠŸèƒ½å®Œæ•´å®ç°
- [ ] åœ¨Chromeæµ‹è¯•é€šè¿‡
- [ ] åœ¨Safariæµ‹è¯•é€šè¿‡
- [ ] å¼ºåˆ¶åˆ·æ–°ï¼ˆCmd+Shift+Rï¼‰åæµ‹è¯•
- [ ] å·¦ä¾§æ»šåŠ¨æ¡å·¥ä½œ
- [ ] å³ä¾§æ»šåŠ¨æ¡å·¥ä½œ
- [ ] ç‹¬ç«‹æ»šåŠ¨äº’ä¸å½±å“
- [ ] Consoleæ— é”™è¯¯
- [ ] ä»£ç å·²æ ¼å¼åŒ–
- [ ] å·²æäº¤Git

---

## ğŸ“ å®Œæˆåæäº¤ï¼ˆå¿…åšï¼ï¼‰

### æ­¥éª¤1: æäº¤å®Œæˆ
1. æ‰“å¼€ Dashboard: http://localhost:8831
2. è¿›å…¥"å…¨æ ˆå·¥ç¨‹å¸ˆå·¥ä½œå°" â†’ "ä»»åŠ¡çœ‹æ¿" Tab
3. æ‰¾åˆ°ä»»åŠ¡ `{task_id}`ï¼ˆç°åœ¨åº”è¯¥åœ¨"è¿›è¡Œä¸­"æ ï¼‰
4. ç‚¹å‡» **"âœ… æäº¤å®Œæˆ"** æŒ‰é’®
5. å¡«å†™ï¼š
   - **å®é™…å·¥æ—¶**: ___ å°æ—¶
   - **å®Œæˆè¯´æ˜**: å·²ä¿®å¤å³ä¾§æ»šåŠ¨æ¡ï¼Œæµ‹è¯•é€šè¿‡

### æ­¥éª¤2: å¤åˆ¶å®ŒæˆæŠ¥å‘Š
1. åˆ·æ–°Dashboard
2. ä»»åŠ¡ç§»åˆ°"å·²å®Œæˆ"æ 
3. ç‚¹å‡» **"å¤åˆ¶å®ŒæˆæŠ¥å‘Š"** æŒ‰é’®
4. ç²˜è´´åˆ°æ–°å¯¹è¯

### æ­¥éª¤3: è¡¥å……è¯¦ç»†ä¿¡æ¯
åœ¨å®ŒæˆæŠ¥å‘ŠåŸºç¡€ä¸Šï¼Œè¡¥å……ï¼š

```markdown
## å®ç°çš„åŠŸèƒ½
1. ä¿®å¤äº† .messages-container çš„CSS
2. æ·»åŠ äº†è¶³å¤Ÿå¤šçš„ç¤ºä¾‹æ¶ˆæ¯
3. ç¡®ä¿å†…å®¹è¶…å‡ºå®¹å™¨é«˜åº¦

## ä¿®æ”¹çš„æ–‡ä»¶
- dashboard-test-8831/index.htmlï¼ˆCSSå’ŒJavaScriptï¼‰

## é‡åˆ°çš„é—®é¢˜
1. åˆå§‹å³ä¾§å†…å®¹å¤ªå°‘ï¼Œæ— æ³•è§¦å‘æ»šåŠ¨æ¡
2. CSS min-height: 0 ç¼ºå¤±

## è§£å†³æ–¹æ¡ˆ
1. æ·»åŠ 8æ¡ç¤ºä¾‹æ¶ˆæ¯
2. å®Œå–„CSSåŒæ»šåŠ¨4å±‚ç»“æ„

## æµ‹è¯•ç»“æœ
âœ… å·¦ä¾§æ»šåŠ¨æ­£å¸¸
âœ… å³ä¾§æ»šåŠ¨æ­£å¸¸
âœ… ç‹¬ç«‹æ»šåŠ¨äº’ä¸å¹²æ‰°
```

### æ­¥éª¤4: æäº¤ç»™æ¶æ„å¸ˆå®¡æŸ¥
å°†å®Œæ•´æŠ¥å‘Šå‘é€ç»™æ¶æ„å¸ˆã€‚

---

## ğŸ’¡ å¼€å‘æç¤º

### å…³é”®ç‚¹
1. **CSS 4å±‚ç»“æ„** - å‚è€ƒè¡€æ³ªæ•™è®­æ–‡æ¡£
2. **å†…å®¹è¶³å¤Ÿå¤š** - ç¡®ä¿è§¦å‘æ»šåŠ¨æ¡
3. **æµ‹è¯•å……åˆ†** - ä¸åŒæµè§ˆå™¨å’Œåœºæ™¯

### å¦‚æœé‡åˆ°é—®é¢˜
1. æŸ¥çœ‹ `âœ…æ»šåŠ¨æ¡å®Œå…¨ä¿®å¤-å·¦å³åŒæ»šåŠ¨-8831.md`
2. å‚è€ƒæ¶æ„å¸ˆæ¨¡å—çš„å®ç°
3. ä½¿ç”¨æµè§ˆå™¨F12æ£€æŸ¥CSS
4. åŠæ—¶åé¦ˆç»™æ¶æ„å¸ˆ

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸ’ª

**æ¶æ„å¸ˆ**: AI Architect (Expert Level)  
**æ´¾å‘æ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
    
    # ä¿å­˜æç¤ºè¯
    prompt_file = Path(__file__).parent.parent / f"ğŸ“¤æ´¾å‘ç»™å…¨æ ˆå·¥ç¨‹å¸ˆ-{task_id}.md"
    with open(prompt_file, 'w', encoding='utf-8') as f:
        f.write(prompt)
    
    print(f"\nâœ… ä»»åŠ¡æç¤ºè¯å·²ç”Ÿæˆ: {prompt_file.name}\n")
    print("="*70)
    print("ğŸ“‹ ä»»åŠ¡æç¤ºè¯å†…å®¹ï¼š".center(70))
    print("="*70)
    print(prompt)
    print("\n" + "="*70)
    print("âœ… è¯·å¤åˆ¶ä»¥ä¸Šå†…å®¹å‘ç»™å…¨æ ˆå·¥ç¨‹å¸ˆï¼".center(70))
    print("="*70 + "\n")


# ============================================
# åˆ›å»ºçœŸå®ä»»åŠ¡
# ============================================

if __name__ == "__main__":
    print("\nğŸ¯ æ¶æ„å¸ˆå‘èµ·ä»»åŠ¡\n")
    
    # åˆ›å»ºä»»åŠ¡ï¼šä¿®å¤å…¨æ ˆå·¥ç¨‹å¸ˆå¯¹è¯å†å²å³ä¾§æ»šåŠ¨æ¡
    create_task(
        task_id="TASK-UI-105",
        title="ä¿®å¤å…¨æ ˆå·¥ç¨‹å¸ˆå¯¹è¯å†å²å³ä¾§æ»šåŠ¨æ¡",
        description="""
ä¿®å¤å…¨æ ˆå·¥ç¨‹å¸ˆå·¥ä½œå°"å¯¹è¯å†å²"Tabçš„å³ä¾§æ»šåŠ¨æ¡é—®é¢˜ã€‚

ã€é—®é¢˜æè¿°ã€‘
å½“å‰çŠ¶æ€ï¼š
- âœ… å·¦ä¾§å¯¹è¯åˆ—è¡¨æ»šåŠ¨æ¡æ­£å¸¸
- âŒ å³ä¾§æ¶ˆæ¯å®¹å™¨æ»šåŠ¨æ¡ä¸æ˜¾ç¤º

ã€æ ¹æœ¬åŸå› ã€‘
1. å³ä¾§æ¶ˆæ¯å†…å®¹å¤ªå°‘ï¼Œæœªè¶…å‡ºå®¹å™¨é«˜åº¦
2. å¯èƒ½CSSåŒæ»šåŠ¨ç»“æ„ä¸å®Œæ•´

ã€è§£å†³æ–¹æ¡ˆã€‘
1. æ£€æŸ¥å¹¶å®Œå–„CSSåŒæ»šåŠ¨4å±‚ç»“æ„ï¼š
   - å¤–å±‚: overflow: hidden, min-height: 0
   - æ¶ˆæ¯å®¹å™¨: flex: 1, overflow-y: auto, min-height: 0
   - å›ºå®šåŒºåŸŸ: flex-shrink: 0

2. ç»™æ¯ä¸ªå¯¹è¯æ·»åŠ è¶³å¤Ÿå¤šçš„ç¤ºä¾‹æ¶ˆæ¯ï¼ˆè‡³å°‘8-10æ¡ï¼‰

3. ç¡®ä¿æ¶ˆæ¯å†…å®¹è¶³å¤Ÿé•¿ï¼Œè¶…å‡ºå®¹å™¨é«˜åº¦

ã€æŠ€æœ¯è¦æ±‚ã€‘
- å‚è€ƒæ¶æ„å¸ˆæ¨¡å—çš„å®ç°ï¼ˆarchitect-conversations Tabï¼‰
- éµå¾ªCSSåŒæ»šåŠ¨è¡€æ³ªæ•™è®­
- ç¡®ä¿å·¦å³ç‹¬ç«‹æ»šåŠ¨äº’ä¸å¹²æ‰°

ã€æµ‹è¯•è¦æ±‚ã€‘
- Chromeå’ŒSafariéƒ½è¦æµ‹è¯•
- å¼ºåˆ¶åˆ·æ–°ï¼ˆCmd+Shift+Rï¼‰åæµ‹è¯•
- éªŒè¯ç‹¬ç«‹æ»šåŠ¨

ã€éªŒæ”¶æ ‡å‡†ã€‘
- [ ] å³ä¾§æ»šåŠ¨æ¡æ­£å¸¸æ˜¾ç¤º
- [ ] ç‚¹å‡»ä¸åŒå¯¹è¯ï¼Œå³ä¾§å†…å®¹æ›´æ–°ä¸”å¯æ»šåŠ¨
- [ ] å·¦å³æ»šåŠ¨äº’ä¸å¹²æ‰°
- [ ] å¼ºåˆ¶åˆ·æ–°åä»æ­£å¸¸
- [ ] Consoleæ— é”™è¯¯

ã€å‚è€ƒæ–‡æ¡£ã€‘
- âœ…æ»šåŠ¨æ¡å®Œå…¨ä¿®å¤-å·¦å³åŒæ»šåŠ¨-8831.md
- dashboard-test-8831/index.htmlï¼ˆç¬¬9337è¡Œï¼Œarchitect-conversationsçš„å®ç°ï¼‰

ã€é¢„ä¼°å·¥æ—¶ã€‘
1-2å°æ—¶ï¼ˆCSSè°ƒæ•´ + å†…å®¹è¡¥å…… + æµ‹è¯•ï¼‰
""",
        priority="P1",
        estimated_hours=2.0,
        complexity="low",
        tags=["frontend", "css", "scrollbar", "bugfix"],
        parallel=True  # å¯å¹¶è¡Œï¼Œç‹¬ç«‹çš„CSSä¿®å¤ä»»åŠ¡
    )

