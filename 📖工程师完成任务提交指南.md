# 📖 工程师完成任务提交指南

**适用场景**: 工程师在Cursor对话中完成任务  
**目标**: 自动调用API更新任务状态

---

## 🔄 完整工作流程

### 步骤1: 架构师发任务（在Dashboard）
架构师使用工具创建任务 → 生成提示词

### 步骤2: 工程师接任务（在Dashboard）
工程师在Dashboard点击"复制提示词" → 任务自动变"进行中"

### 步骤3: 工程师执行任务（在Cursor对话）
工程师粘贴提示词到新Cursor对话 → AI帮助完成任务

### 步骤4: 工程师提交完成（在Cursor对话）⭐核心
工程师在Cursor对话中说：
```
任务已完成，请帮我提交完成报告。

实际工时：2小时
完成说明：功能已实现并测试通过
```

### 步骤5: AI自动调用API（在Cursor对话）
AI执行：
```python
import requests

response = requests.post(
    'http://localhost:8800/api/engineer/tasks/TEST-2025-001/complete',
    json={
        'actual_hours': 2.0,
        'notes': '功能已实现并测试通过',
        'features': ['功能1', '功能2'],
        'files_created': ['file1.py'],
        'files_modified': ['file2.py'],
        'code_lines': 150
    }
)

result = response.json()
# 返回: {"success": true, "message": "任务已完成"}
```

### 步骤6: 验证（在Dashboard）
工程师刷新Dashboard → 任务出现在"已完成"栏 → 点击"复制完成报告"

---

## 📝 工程师在Cursor中的完成报告模板

当工程师完成任务后，在Cursor对话中说：

```
任务 TEST-2025-001 已完成，请帮我提交完成报告。

【完成情况】
- 实际工时：2小时
- 完成说明：功能已实现并测试通过

【实现的功能】
1. 实现了XXX功能
2. 添加了YYY组件
3. 优化了ZZZ性能

【创建的文件】
- apps/xxx/new_file.py
- templates/new_template.html

【修改的文件】
- apps/xxx/existing_file.py
- config/settings.py

【代码统计】
- 新增代码：150行
- 修改代码：50行

【测试结果】
✅ 单元测试通过
✅ 功能测试通过
✅ 浏览器测试通过
```

---

## 🤖 AI的响应脚本

AI收到完成报告后，自动执行：

```python
# AI在Cursor中执行
import requests
import json

# 调用API提交完成
response = requests.post(
    'http://localhost:8800/api/engineer/tasks/TEST-2025-001/complete',
    headers={'Content-Type': 'application/json'},
    json={
        'actual_hours': 2.0,
        'notes': '功能已实现并测试通过',
        'features': ['实现了XXX功能', '添加了YYY组件', '优化了ZZZ性能'],
        'files_created': ['apps/xxx/new_file.py', 'templates/new_template.html'],
        'files_modified': ['apps/xxx/existing_file.py', 'config/settings.py'],
        'code_lines': 200
    }
)

result = response.json()

if result['success']:
    print(f"""
✅ 任务提交成功！

任务ID: TEST-2025-001
状态: 进行中 → 已完成
实际工时: 2.0小时

请前往Dashboard查看：
http://localhost:8831

在"全栈工程师工作台" → "任务看板" → "已完成"栏
找到任务后点击"复制完成报告"按钮，将报告提交给架构师审查。
""")
```

---

## 🎯 Cursor中的AI提示词模板

工程师可以这样配置AI的系统提示词：

```markdown
当我说"任务完成"或"提交完成报告"时，请：

1. 提取我提供的完成信息
2. 调用API提交完成：
   POST http://localhost:8800/api/engineer/tasks/{TASK_ID}/complete
3. 更新任务状态为completed
4. 告诉我去Dashboard复制完成报告

API调用示例：
```python
import requests
requests.post(
    'http://localhost:8800/api/engineer/tasks/TASK-ID/complete',
    json={
        'actual_hours': 实际工时,
        'notes': '完成说明',
        'features': ['功能列表'],
        'files_created': ['新建文件'],
        'files_modified': ['修改文件'],
        'code_lines': 代码行数
    }
)
```
```

---

## 📊 完整流程图

```
┌─────────────────────────────────────┐
│ 架构师（Dashboard）                  │
│ - 创建任务                           │
│ - 生成提示词                         │
└──────────────┬──────────────────────┘
               │ 提示词
               ↓
┌─────────────────────────────────────┐
│ 工程师（Dashboard）                  │
│ - 点击"复制提示词"                   │
│ - 系统自动: pending → in_progress   │
└──────────────┬──────────────────────┘
               │ 粘贴提示词
               ↓
┌─────────────────────────────────────┐
│ 工程师（Cursor对话）                 │
│ - 执行任务开发                       │
│ - 完成后说"任务完成"                 │
└──────────────┬──────────────────────┘
               │
               ↓
┌─────────────────────────────────────┐
│ AI（Cursor对话）                     │
│ - 调用API提交完成报告                │
│ - POST /api/tasks/{id}/complete     │
│ - 系统: in_progress → completed     │
└──────────────┬──────────────────────┘
               │ 完成通知
               ↓
┌─────────────────────────────────────┐
│ 工程师（Dashboard）                  │
│ - 刷新页面                           │
│ - 任务在"已完成"栏                   │
│ - 点击"复制完成报告"                 │
└──────────────┬──────────────────────┘
               │ 完成报告
               ↓
┌─────────────────────────────────────┐
│ 架构师                               │
│ - 审查完成报告                       │
│ - 通过/要求修改                      │
└─────────────────────────────────────┘
```

---

## 🎯 现在请测试

点击截图中的 **"复制提示词"** 按钮，然后：
1. 粘贴（Cmd+V）看是否成功复制
2. 查看是否弹出提示框
3. 刷新页面后，点击"进行中"筛选，看任务是否移过去

**告诉我测试结果！** 🚀
