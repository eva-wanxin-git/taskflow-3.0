# 🎯 全栈工程师任务模块 - 完整测试指南

**测试时间**: 2025-11-22  
**测试环境**: 8831  
**测试内容**: 架构师发任务 → 工程师接任务 → 完成任务 完整流程

---

## ✅ 部署完成清单

| 功能模块 | 状态 | 说明 |
|---------|------|------|
| 任务数据文件 | ✅ | 58个真实任务（从数据库提取） |
| API端点-获取任务 | ✅ | GET /api/engineer/tasks |
| API端点-接受任务 | ✅ | POST /api/engineer/tasks/{id}/accept |
| API端点-提交完成 | ✅ | POST /api/engineer/tasks/{id}/complete |
| 前端任务看板 | ✅ | 硬编码已清除，改为动态加载 |
| JavaScript加载逻辑 | ✅ | loadEngineerTasks() 自动调用 |
| 任务卡片渲染 | ✅ | createTaskCard() 动态创建 |
| 三态按钮逻辑 | ✅ | 待处理/进行中/已完成不同按钮 |
| 详情弹窗 | ✅ | 提示词/进度/报告三种模式 |
| 任务筛选 | ✅ | 全部/待处理/进行中/已完成 |
| 架构师创建任务工具 | ✅ | Python脚本 + 自动生成提示词 |
| 架构师发任务指南 | ✅ | 完整操作文档 |

---

## 🚀 测试流程（完整演示）

### 准备：确认服务运行

```bash
# 检查8800端口（API）
lsof -i :8800

# 检查8831端口（Dashboard）
lsof -i :8831

# 如果没运行，启动服务
```

---

### 场景1: 架构师创建新任务 ✅

**已完成**: 架构师刚才创建了任务 **TASK-UI-105**

**任务详情**:
- 标题: 修复全栈工程师对话历史右侧滚动条
- 优先级: P1
- 预估: 2小时
- 可并行: 是 ✅
- 状态: 待处理

**提示词已生成**: `📤派发给全栈工程师-TASK-UI-105.md`

---

### 场景2: 工程师查看任务

#### 步骤1: 访问Dashboard
打开浏览器: **http://localhost:8831**

#### 步骤2: 进入任务看板
1. 点击左侧导航 **"全栈工程师工作台"**
2. 点击顶部 **"任务看板"** Tab（默认就是这个Tab）

#### 步骤3: 验证数据加载

**预期看到**:
- ✅ 任务卡片列表（不是"正在加载..."）
- ✅ 筛选按钮显示数量：
  - 全部 (40)
  - 待处理 (33) ← 包含新任务TASK-UI-105
  - 进行中 (1)
  - 已完成 (21)

**打开Console查看**（F12）:
```
📋 开始加载全栈工程师任务列表...
✅ 任务列表加载成功，任务数: 40
   待处理: 33
   进行中: 1
   已完成: 21
✅ 渲染了 40 个任务卡片
```

#### 步骤4: 找到新任务

**方法1**: 滚动列表查找 `TASK-UI-105`

**方法2**: 点击"待处理"筛选，任务应该在前面（P1优先级）

**任务卡片应该显示**:
```
┌─────────────────────────────────────────┐
│ TASK-UI-105                             │
│ 修复全栈工程师对话历史右侧滚动条         │
├─────────────────────────────────────────┤
│ 修复全栈工程师工作台"对话历史"Tab...    │
├─────────────────────────────────────────┤
│ 预估: 2小时  ⚪ 待处理                  │
│ 可并行 ✅  P1                           │
├─────────────────────────────────────────┤
│ [✅ 接受任务]  [查看详情]               │
└─────────────────────────────────────────┘
```

---

### 场景3: 工程师点击"查看详情"

#### 操作
点击 **TASK-UI-105** 卡片的 **"查看详情"** 按钮

#### 预期效果
弹出模态框，显示：

**标题**: 任务提示词

**内容**:
```markdown
# 📤 派发给全栈工程师 - TASK-UI-105

**派发人**: AI架构师 (Expert Level)
**优先级**: P1
**预估工时**: 2.0小时
**是否可并行**: 是 ✅

---

## 📋 任务描述

修复全栈工程师工作台"对话历史"Tab的右侧滚动条问题。

【问题描述】
当前状态：
- ✅ 左侧对话列表滚动条正常
- ❌ 右侧消息容器滚动条不显示
...
```

**底部按钮**:
- [复制内容] - 复制整个提示词
- [关闭] - 关闭弹窗

---

### 场景4: 工程师接受任务 ⭐核心功能

#### 操作
点击 **TASK-UI-105** 卡片的 **"✅ 接受任务"** 按钮

#### 预期流程

**1. 弹出确认框**:
```
确认接受任务 TASK-UI-105？

接受后任务状态将变为"进行中"，请及时完成任务。

[取消] [确定]
```

**2. 点击"确定"后**:
- 🔄 调用API: `POST http://localhost:8800/api/engineer/tasks/TASK-UI-105/accept`
- 🔄 更新数据库: `UPDATE tasks SET status='in_progress' WHERE id='TASK-UI-105'`

**3. 成功提示**:
```
✅ 任务已接受！

任务ID: TASK-UI-105
状态: 待处理 → 进行中

请开始执行任务。
```

**4. 自动刷新**:
- 任务列表重新加载
- TASK-UI-105 从"待处理"栏消失
- TASK-UI-105 出现在"进行中"栏
- 按钮变为：[重新派发任务] [查看详情] [✅ 提交完成]
- 筛选数量更新：待处理(32) 进行中(2)

---

### 场景5: 工程师完成任务并提交

#### 操作（假设工程师完成了开发）

1. 在"进行中"栏找到 **TASK-UI-105**
2. 点击 **"✅ 提交完成"** 按钮

#### 预期流程

**1. 弹出工时输入框**:
```
请输入实际工时（小时）:
[1.5]
```

**2. 弹出完成说明输入框**:
```
请输入完成说明（可选）:
[已修复右侧滚动条，添加了8条示例消息，测试通过]
```

**3. 提交后**:
- 🔄 调用API: `POST http://localhost:8800/api/engineer/tasks/TASK-UI-105/complete`
- 🔄 更新数据库: `UPDATE tasks SET status='completed', actual_hours=1.5 WHERE id='TASK-UI-105'`

**4. 成功提示**:
```
✅ 任务已完成！

任务ID: TASK-UI-105
状态: 进行中 → 已完成
实际工时: 1.5小时

刷新页面查看更新。
```

**5. 自动刷新**:
- TASK-UI-105 从"进行中"栏消失
- TASK-UI-105 出现在"已完成"栏
- 按钮变为：[复制完成报告] [查看详情]
- 筛选数量更新：进行中(1) 已完成(22)

---

### 场景6: 复制完成报告

#### 操作
在"已完成"栏，点击 **TASK-UI-105** 的 **"复制完成报告"** 按钮

#### 预期效果

**1. 复制到剪贴板**:
```markdown
# ✅ 任务完成报告 - TASK-UI-105

**任务标题**: 修复全栈工程师对话历史右侧滚动条
**优先级**: P1
**完成时间**: 2025-11-22 15:30:00
**实际工时**: 1.5小时

---

## 任务描述
修复全栈工程师工作台"对话历史"Tab的右侧滚动条问题...

---

## 完成情况
✅ 任务已完成
⏱️ 工时: 1.5/2.0小时

---
**提交人**: 全栈工程师
**提交时间**: 2025-11-22 15:30:15
```

**2. 按钮反馈**:
- 按钮文字变为 "✅ 已复制"
- 按钮背景变绿
- 2秒后恢复原状

---

## 🔍 验证清单

### API验证

```bash
# 1. 获取任务列表
curl http://localhost:8800/api/engineer/tasks | python3 -m json.tool | head -50

# 2. 接受任务（测试）
curl -X POST http://localhost:8800/api/engineer/tasks/TASK-FE-999/accept

# 3. 查看数据库
sqlite3 database/data/tasks.db "SELECT id, title, status FROM tasks WHERE id='TASK-FE-999'"
```

### 前端验证

#### ✅ 数据加载
- [ ] 打开 http://localhost:8831
- [ ] 进入全栈工程师工作台 → 任务看板
- [ ] 看到任务列表（不是"正在加载..."）
- [ ] Console有成功日志
- [ ] 筛选数量正确显示

#### ✅ 待处理任务
- [ ] 找到TASK-UI-105或其他pending任务
- [ ] 显示"✅ 接受任务"和"查看详情"按钮
- [ ] 有"可并行"标签的显示徽章
- [ ] 优先级徽章颜色正确（P0红色、P1橙色、P2蓝色）

#### ✅ 接受任务
- [ ] 点击"✅ 接受任务"
- [ ] 弹出确认框
- [ ] 确认后显示成功提示
- [ ] 任务自动移到"进行中"栏
- [ ] 筛选数量自动更新

#### ✅ 进行中任务
- [ ] 显示3个按钮：重新派发/查看详情/提交完成
- [ ] 点击"查看详情"显示进度报告
- [ ] 点击"提交完成"弹出工时输入框

#### ✅ 提交完成
- [ ] 输入实际工时（如1.5）
- [ ] 输入完成说明
- [ ] 成功提示显示
- [ ] 任务移到"已完成"栏
- [ ] 筛选数量更新

#### ✅ 已完成任务
- [ ] 显示2个按钮：复制完成报告/查看详情
- [ ] 点击"复制完成报告"
- [ ] 按钮变绿显示"✅ 已复制"
- [ ] 粘贴测试（Cmd+V）看到完成报告

#### ✅ 任务筛选
- [ ] 点击"待处理" → 只显示pending任务
- [ ] 点击"进行中" → 只显示in_progress任务
- [ ] 点击"已完成" → 只显示completed任务
- [ ] 点击"全部" → 显示所有任务

#### ✅ 任务排序
- [ ] 选择"按优先级排序" → P0在前
- [ ] 选择"按时间排序" → 最新在前
- [ ] 选择"按复杂度排序" → high在前

---

## 🎯 完整测试流程（推荐）

### 测试任务：TASK-UI-105

#### 第1步: 刷新浏览器
**http://localhost:8831** 按 **Cmd+Shift+R** 强制刷新

#### 第2步: 进入任务看板
全栈工程师工作台 → 任务看板 Tab

#### 第3步: 找到新任务
- 点击"待处理"筛选
- 查找 **TASK-UI-105**（优先级P1，应该在前面）
- 确认显示"可并行 ✅"徽章

#### 第4步: 查看任务详情
- 点击"查看详情"按钮
- 验证弹窗显示完整任务提示词
- 点击"复制内容"测试
- 关闭弹窗

#### 第5步: 接受任务
- 点击"✅ 接受任务"
- 确认对话框
- 等待成功提示
- **验证**: 任务移到"进行中"栏

#### 第6步: 查看进度
- 在"进行中"栏找到TASK-UI-105
- 点击"查看详情"
- 验证显示进度报告
- 关闭弹窗

#### 第7步: 提交完成
- 点击"✅ 提交完成"
- 输入工时: **1.5**
- 输入说明: **已修复，测试通过**
- 等待成功提示
- **验证**: 任务移到"已完成"栏

#### 第8步: 复制报告
- 在"已完成"栏找到TASK-UI-105
- 点击"复制完成报告"
- 验证按钮变绿
- 粘贴到文本编辑器验证内容

---

## 🐛 常见问题排查

### 问题1: 看不到任务列表

**症状**: 只显示"正在加载..."

**检查**:
```bash
# 1. API是否返回数据
curl http://localhost:8800/api/engineer/tasks

# 2. 查看Console错误
# F12 → Console → 查找红色错误信息
```

**解决**:
- 确保8800端口API服务运行
- 检查CORS配置
- 强制刷新浏览器

---

### 问题2: 点击"接受任务"无反应

**症状**: 点击按钮没有弹窗

**检查**:
```javascript
// Console执行
typeof acceptEngineerTask
// 应该返回: "function"

// 测试调用
acceptEngineerTask('TASK-UI-105', {stopPropagation: () => {}})
```

**解决**:
- 检查JavaScript是否有语法错误
- 查看Console的错误信息
- 确认函数已定义

---

### 问题3: 状态不更新

**症状**: 点击后有提示，但任务不移动

**检查**:
```bash
# 检查数据库状态
sqlite3 database/data/tasks.db "SELECT id, title, status FROM tasks WHERE id='TASK-UI-105'"
```

**解决**:
- API可能失败，查看Console
- 手动刷新浏览器
- 检查数据库权限

---

## 📊 架构师发任务快速参考

### 方法1: 使用Python工具（推荐）

```bash
cd /Users/yalinwang/Desktop/任务所\ 1.8/taskflow-v1-2/taskflow-v1-2

# 编辑脚本，修改任务信息
nano scripts/create_scrollbar_fix_task.py

# 修改这些参数：
# - task_id: "TASK-XX-XXX"
# - title: "任务标题"
# - description: "详细描述..."
# - priority: "P0/P1/P2"
# - estimated_hours: 数字
# - parallel: True/False

# 执行创建
python3 scripts/create_scrollbar_fix_task.py
```

### 方法2: 复制模板快速创建

复制 `scripts/create_scrollbar_fix_task.py`，修改任务信息后执行。

### 发任务提示词

**自动生成**: `📤派发给全栈工程师-{TASK_ID}.md`

**手动复制**: 脚本执行后会打印完整提示词到控制台

---

## 🎯 测试成功标准

| 测试项 | 状态 |
|--------|------|
| API返回任务列表 | ✅ |
| 前端显示任务卡片 | ⬜ |
| 待处理任务按钮正确 | ⬜ |
| 点击"查看详情"显示提示词 | ⬜ |
| 点击"接受任务"成功 | ⬜ |
| 任务移到"进行中"栏 | ⬜ |
| 进行中任务按钮正确 | ⬜ |
| 点击"查看详情"显示进度 | ⬜ |
| 点击"提交完成"成功 | ⬜ |
| 任务移到"已完成"栏 | ⬜ |
| 已完成任务按钮正确 | ⬜ |
| 点击"复制报告"成功 | ⬜ |
| 筛选功能正常 | ⬜ |
| 排序功能正常 | ⬜ |
| 可并行标签显示 | ⬜ |

---

## 📝 现在开始测试

### 1. 强制刷新浏览器
**http://localhost:8831** 按 **Cmd+Shift+R**

### 2. 进入任务看板
全栈工程师工作台 → 任务看板 Tab

### 3. 查看Console
**F12** → Console标签

**预期日志**:
```
📋 开始加载全栈工程师任务列表...
✅ 任务列表加载成功，任务数: 40
   待处理: 33
   进行中: 1
   已完成: 21
✅ 渲染了 40 个任务卡片
```

### 4. 测试新任务
找到 **TASK-UI-105**，测试完整流程：
1. 查看详情 ✅
2. 接受任务 ✅
3. 提交完成 ✅
4. 复制报告 ✅

---

**请现在刷新浏览器开始测试！** 🚀

如果有任何问题，请告诉我Console的错误信息！

