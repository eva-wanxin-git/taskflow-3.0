<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>å¯¹è¯å†å²æ¡£æ¡ˆé¦† - ä»»åŠ¡æ‰€Â·Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --black: #000000;
            --gray-900: #212121;
            --gray-700: #616161;
            --gray-600: #757575;
            --gray-500: #9E9E9E;
            --gray-300: #E0E0E0;
            --gray-100: #F5F5F5;
            --gray-50: #FAFAFA;
            --white: #FFFFFF;
            --red: #985239;
            --blue: #537696;
            
            --status-active: #4CAF50;
            --status-completed: #9E9E9E;
            --status-archived: #1976D2;
            
            --space-2: 8px;
            --space-4: 16px;
            --space-6: 24px;
            --space-8: 32px;
            
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            background: var(--white);
            color: var(--gray-900);
            line-height: 1.6;
        }
        
        /* å¤´éƒ¨ */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-300);
            padding: var(--space-4) var(--space-8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .back-button {
            text-decoration: none;
            color: var(--gray-700);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .back-button:hover {
            color: var(--black);
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }
        
        .header-actions {
            display: flex;
            gap: var(--space-4);
        }
        
        .btn-primary {
            padding: var(--space-2) var(--space-4);
            font-size: 13px;
            background: var(--red);
            color: var(--white);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: var(--black);
        }
        
        .btn-secondary {
            padding: var(--space-2) var(--space-4);
            font-size: 13px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background: var(--black);
            color: var(--white);
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--space-8);
        }
        
        /* ç»Ÿè®¡å¸¦ */
        .stats-banner {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
            border: 1px solid var(--gray-300);
            border-top: 2px solid var(--blue);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .stat-icon {
            font-size: 18px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--black);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--gray-600);
        }
        
        /* ç­›é€‰æ  */
        .filter-bar {
            background: var(--white);
            border: 1px solid var(--gray-300);
            padding: var(--space-4) var(--space-6);
            margin-bottom: var(--space-6);
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }
        
        .filter-tag {
            padding: var(--space-2) var(--space-4);
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .filter-tag.active {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }
        
        .filter-tag:hover {
            border-color: var(--black);
        }
        
        /* ä¼šè¯Grid */
        .sessions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-6);
        }
        
        .session-card {
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-top: 2px solid var(--status-active);
            padding: var(--space-6);
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
        }
        
        .session-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .session-card.completed {
            border-top-color: var(--status-completed);
        }
        
        .session-card.archived {
            border-top-color: var(--status-archived);
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        
        .session-id {
            font-size: 12px;
            color: var(--gray-600);
            font-family: monospace;
        }
        
        .status-badge {
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-badge.active {
            background: var(--status-active);
            color: var(--white);
        }
        
        .status-badge.completed {
            background: var(--status-completed);
            color: var(--white);
        }
        
        .status-badge.archived {
            background: var(--status-archived);
            color: var(--white);
        }
        
        .session-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: var(--space-2);
        }
        
        .session-time {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
        }
        
        .session-stats {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
            font-size: 12px;
            color: var(--gray-700);
        }
        
        .token-progress {
            height: 6px;
            background: var(--gray-100);
            border-radius: 3px;
            margin-bottom: var(--space-4);
            overflow: hidden;
        }
        
        .token-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--status-active) 0%, var(--red) 100%);
            transition: width 0.6s ease-out;
        }
        
        .session-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }
        
        .tag {
            padding: 2px 8px;
            background: var(--gray-100);
            border-radius: 2px;
            font-size: 10px;
            color: var(--gray-700);
        }
        
        .session-summary {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
            line-height: 1.6;
        }
        
        .session-actions {
            display: flex;
            gap: var(--space-2);
            padding-top: var(--space-4);
            border-top: 1px solid var(--gray-300);
        }
        
        .session-action-btn {
            flex: 1;
            padding: var(--space-2);
            font-size: 12px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .session-action-btn:hover {
            background: var(--black);
            color: var(--white);
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .sessions-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: var(--space-8);
            color: var(--gray-600);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-300);
            border-top-color: var(--red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <a href="/" class="back-button">â† è¿”å›Dashboard</a>
        <div class="page-title">ğŸ’¬ å¯¹è¯å†å²æ¡£æ¡ˆé¦†</div>
        <div class="header-actions">
            <button class="btn-primary" onclick="createNewSession()">+ æ–°å¯¹è¯</button>
            <button class="btn-secondary" onclick="searchSessions()">ğŸ” æœç´¢</button>
        </div>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- ç»Ÿè®¡å¸¦ -->
        <div class="stats-banner">
            <div class="stat-item">
                <span class="stat-icon">ğŸ“Š</span>
                <div>
                    <div class="stat-value" id="totalSessionsCount">5</div>
                    <div class="stat-label">ä¸ªä¼šè¯</div>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ’¬</span>
                <div>
                    <div class="stat-value" id="totalMessagesCount">156</div>
                    <div class="stat-label">æ¡æ¶ˆæ¯</div>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ”¢</span>
                <div>
                    <div class="stat-value" id="totalTokensCount">125,000</div>
                    <div class="stat-label">tokens</div>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ“…</span>
                <div>
                    <div class="stat-value" style="font-size: 16px;" id="lastSessionTime">2å°æ—¶å‰</div>
                    <div class="stat-label">æœ€åå¯¹è¯</div>
                </div>
            </div>
        </div>
        
        <!-- ç­›é€‰æ  -->
        <div class="filter-bar">
            <div class="filter-tag active" data-filter="all">å…¨éƒ¨</div>
            <div class="filter-tag" data-filter="active">æ´»è·ƒä¸­</div>
            <div class="filter-tag" data-filter="completed">å·²å®Œæˆ</div>
            <div class="filter-tag" data-filter="archived">å·²å½’æ¡£</div>
        </div>
        
        <!-- ä¼šè¯åˆ—è¡¨ -->
        <div id="sessionsContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div style="margin-top: var(--space-4);">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <script>
        let allSessions = [];
        let currentFilter = 'all';
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¬ å¯¹è¯å†å²é¡µé¢å·²åŠ è½½');
            loadSessions();
            setupFilters();
        });
        
        // åŠ è½½ä¼šè¯
        async function loadSessions() {
            try {
                const response = await fetch('/api/conversations');
                const data = await response.json();
                
                if (data.sessions) {
                    allSessions = data.sessions;
                    renderSessions();
                    updateStats();
                    console.log('âœ… ä¼šè¯å·²åŠ è½½:', allSessions.length);
                } else {
                    // åˆ›å»ºç¤ºä¾‹æ•°æ®
                    allSessions = [
                        {
                            session_id: 'session-001',
                            title: 'Dashboardé‡æ„è®¨è®º',
                            status: 'completed',
                            created_at: '2025-11-18 22:30:00',
                            messages_count: 6,
                            total_tokens: 25000,
                            tags: ['Dashboard', 'é‡æ„', 'UI'],
                            summary: 'è®¨è®ºäº†Dashboardçš„é‡æ„æ–¹æ¡ˆï¼Œå†³å®šé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡'
                        },
                        {
                            session_id: 'session-002',
                            title: 'APIé›†æˆè®¨è®º',
                            status: 'active',
                            created_at: '2025-11-19 10:00:00',
                            messages_count: 12,
                            total_tokens: 45000,
                            tags: ['API', 'é›†æˆ', 'æµ‹è¯•'],
                            summary: 'æ­£åœ¨è®¨è®ºå¦‚ä½•é›†æˆå„ä¸ªAPIæ¨¡å—ï¼Œè§£å†³äº†TokenåŒæ­¥é—®é¢˜'
                        },
                        {
                            session_id: 'session-003',
                            title: 'æ€§èƒ½ä¼˜åŒ–åˆ†æ',
                            status: 'completed',
                            created_at: '2025-11-17 15:20:00',
                            messages_count: 8,
                            total_tokens: 32000,
                            tags: ['æ€§èƒ½', 'ä¼˜åŒ–', 'SQLite'],
                            summary: 'åˆ†æäº†ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼Œæå‡ºäº†SQLiteä¼˜åŒ–æ–¹æ¡ˆ'
                        }
                    ];
                    renderSessions();
                    updateStats();
                }
            } catch (error) {
                console.error('âŒ åŠ è½½ä¼šè¯å¤±è´¥:', error);
                document.getElementById('sessionsContainer').innerHTML = `
                    <div class="loading">
                        <div style="color: var(--error);">åŠ è½½å¤±è´¥: ${error.message}</div>
                        <button class="btn-secondary" onclick="loadSessions()" style="margin-top: var(--space-4);">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        // æ¸²æŸ“ä¼šè¯
        function renderSessions() {
            const container = document.getElementById('sessionsContainer');
            
            // è¿‡æ»¤ä¼šè¯
            let filtered = allSessions;
            if (currentFilter !== 'all') {
                filtered = allSessions.filter(s => s.status === currentFilter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div style="font-size: 48px;">ğŸ’¬</div>
                        <div style="margin-top: var(--space-4);">æš‚æ— ä¼šè¯</div>
                    </div>
                `;
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'sessions-grid';
            
            filtered.forEach(session => {
                const statusClass = session.status || 'active';
                const tokenPercent = Math.min((session.total_tokens / 60000) * 100, 100);
                
                const card = document.createElement('div');
                card.className = `session-card ${statusClass}`;
                card.innerHTML = `
                    <div class="session-header">
                        <div class="session-id">${session.session_id}</div>
                        <div class="status-badge ${statusClass}">
                            ${getStatusIcon(statusClass)} ${getStatusText(statusClass)}
                        </div>
                    </div>
                    <div class="session-title">${session.title}</div>
                    <div class="session-time">ğŸ“… ${session.created_at}</div>
                    <div class="session-stats">
                        <span>ğŸ’¬ ${session.messages_count}æ¡æ¶ˆæ¯</span>
                        <span>|</span>
                        <span>ğŸ”¢ ${formatNumber(session.total_tokens)} tokens</span>
                    </div>
                    <div class="token-progress">
                        <div class="token-progress-bar" style="width: ${tokenPercent}%"></div>
                    </div>
                    ${session.tags ? `
                        <div class="session-tags">
                            ğŸ·ï¸ ${session.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}
                        </div>
                    ` : ''}
                    ${session.summary ? `
                        <div class="session-summary">
                            ğŸ“ ${session.summary}
                        </div>
                    ` : ''}
                    <div class="session-actions">
                        <button class="session-action-btn" onclick="event.stopPropagation(); viewSession('${session.session_id}')">æŸ¥çœ‹</button>
                        <button class="session-action-btn" onclick="event.stopPropagation(); continueSession('${session.session_id}')">ç»§ç»­</button>
                        <button class="session-action-btn" onclick="event.stopPropagation(); exportSession('${session.session_id}')">å¯¼å‡º</button>
                    </div>
                `;
                
                card.addEventListener('click', function() {
                    viewSession(session.session_id);
                });
                
                grid.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalSessionsCount').textContent = allSessions.length;
            
            const totalMessages = allSessions.reduce((sum, s) => sum + (s.messages_count || 0), 0);
            document.getElementById('totalMessagesCount').textContent = totalMessages;
            
            const totalTokens = allSessions.reduce((sum, s) => sum + (s.total_tokens || 0), 0);
            document.getElementById('totalTokensCount').textContent = formatNumber(totalTokens);
            
            if (allSessions.length > 0) {
                const lastSession = allSessions[0];
                const time = formatTime(lastSession.updated_at || lastSession.created_at);
                document.getElementById('lastSessionTime').textContent = time;
            }
        }
        
        // è®¾ç½®ç­›é€‰å™¨
        function setupFilters() {
            const filterTags = document.querySelectorAll('.filter-tag');
            filterTags.forEach(tag => {
                tag.addEventListener('click', function() {
                    filterTags.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    renderSessions();
                });
            });
        }
        
        // æŸ¥çœ‹ä¼šè¯
        function viewSession(sessionId) {
            console.log('æŸ¥çœ‹ä¼šè¯:', sessionId);
            window.location.href = `/session-theatre?id=${sessionId}`;
        }
        
        // ç»§ç»­ä¼šè¯
        function continueSession(sessionId) {
            console.log('ç»§ç»­ä¼šè¯:', sessionId);
            alert('ç»§ç»­å¯¹è¯åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // å¯¼å‡ºä¼šè¯
        function exportSession(sessionId) {
            console.log('å¯¼å‡ºä¼šè¯:', sessionId);
            alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // åˆ›å»ºæ–°ä¼šè¯
        function createNewSession() {
            alert('åˆ›å»ºæ–°ä¼šè¯åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // æœç´¢ä¼šè¯
        function searchSessions() {
            alert('æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // å·¥å…·å‡½æ•°
        function getStatusIcon(status) {
            const icons = {
                'active': 'ğŸŸ¢',
                'completed': 'ğŸŸ¡',
                'archived': 'ğŸ”µ'
            };
            return icons[status] || 'âšª';
        }
        
        function getStatusText(status) {
            const texts = {
                'active': 'æ´»è·ƒ',
                'completed': 'å·²å®Œæˆ',
                'archived': 'å·²å½’æ¡£'
            };
            return texts[status] || status;
        }
        
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function formatTime(timestamp) {
            if (!timestamp) return 'æœªçŸ¥';
            
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffHours = Math.floor(diffMs / 3600000);
            
            if (diffHours < 1) return 'åˆšåˆš';
            if (diffHours < 24) return `${diffHours}å°æ—¶å‰`;
            if (diffHours < 168) return `${Math.floor(diffHours/24)}å¤©å‰`;
            return time.toLocaleDateString('zh-CN');
        }
    </script>
</body>
</html>

