<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®°å¿†ç©ºé—´ - æ•°å­—å›¾ä¹¦é¦† - ä»»åŠ¡æ‰€Â·Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --black: #000000;
            --gray-900: #212121;
            --gray-700: #616161;
            --gray-600: #757575;
            --gray-500: #9E9E9E;
            --gray-300: #E0E0E0;
            --gray-100: #F5F5F5;
            --white: #FFFFFF;
            --red: #985239;
            --blue: #537696;
            
            --space-2: 8px;
            --space-4: 16px;
            --space-6: 24px;
            --space-8: 32px;
            
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            background: var(--white);
            color: var(--gray-900);
            line-height: 1.6;
        }
        
        /* å¤´éƒ¨ */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-300);
            padding: var(--space-4) var(--space-8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .back-button {
            text-decoration: none;
            color: var(--gray-700);
            font-size: 14px;
        }
        
        .back-button:hover {
            color: var(--black);
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }
        
        .header-actions {
            display: flex;
            gap: var(--space-4);
        }
        
        .btn {
            padding: var(--space-2) var(--space-4);
            font-size: 13px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            cursor: pointer;
        }
        
        .btn:hover {
            background: var(--black);
            color: var(--white);
        }
        
        .btn-primary {
            background: var(--red);
            color: var(--white);
            border-color: var(--red);
        }
        
        .btn-primary:hover {
            background: var(--black);
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--space-8);
        }
        
        /* å¿«é€Ÿæ“ä½œæ  */
        .quick-actions {
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--white) 100%);
            border: 1px solid var(--gray-300);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            display: flex;
            gap: var(--space-4);
        }
        
        .quick-action-btn {
            flex: 1;
            padding: var(--space-4);
            background: var(--white);
            border: 1px solid var(--gray-300);
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .quick-action-btn:hover {
            background: var(--black);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* ç»Ÿè®¡è„‰æ */
        .stats-pulse {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }
        
        .mini-card {
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-top: 2px solid var(--blue);
            padding: var(--space-4);
            text-align: center;
        }
        
        .mini-card-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: var(--space-2);
        }
        
        .mini-card-label {
            font-size: 11px;
            color: var(--gray-600);
        }
        
        /* ç­›é€‰å¯¼èˆª */
        .filter-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--gray-300);
        }
        
        .filter-tab {
            padding: var(--space-4) var(--space-6);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            transition: all 0.2s;
        }
        
        .filter-tab:hover {
            color: var(--black);
        }
        
        .filter-tab.active {
            color: var(--red);
            border-bottom-color: var(--red);
        }
        
        /* è®°å¿†ç€‘å¸ƒæµ */
        .memories-masonry {
            column-count: 3;
            column-gap: var(--space-6);
        }
        
        .memory-card {
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-top: 3px solid var(--blue);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            break-inside: avoid;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
        }
        
        .memory-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }
        
        .memory-card.decision {
            border-top-color: var(--red);
        }
        
        .memory-card.solution {
            border-top-color: #2E7D32;
        }
        
        .memory-card.knowledge {
            border-top-color: var(--blue);
        }
        
        .memory-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }
        
        .memory-icon {
            font-size: 20px;
        }
        
        .memory-type {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
        }
        
        .memory-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: var(--space-4);
            line-height: 1.3;
        }
        
        .memory-content {
            font-size: 13px;
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: var(--space-4);
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .memory-importance {
            margin-bottom: var(--space-4);
        }
        
        .star-rating {
            display: flex;
            gap: 2px;
            font-size: 14px;
        }
        
        .importance-label {
            font-size: 10px;
            color: var(--gray-600);
            margin-top: 4px;
        }
        
        .memory-footer {
            padding-top: var(--space-4);
            border-top: 1px solid var(--gray-300);
        }
        
        .memory-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }
        
        .tag {
            padding: 2px 6px;
            background: var(--gray-100);
            border-radius: 2px;
            font-size: 10px;
            color: var(--gray-700);
        }
        
        .memory-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--gray-600);
        }
        
        .memory-actions {
            margin-top: var(--space-4);
            display: flex;
            gap: var(--space-2);
        }
        
        .memory-action-btn {
            flex: 1;
            padding: var(--space-2);
            font-size: 11px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            cursor: pointer;
        }
        
        .memory-action-btn:hover {
            background: var(--black);
            color: var(--white);
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .memories-masonry {
                column-count: 2;
            }
            
            .stats-pulse {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .memories-masonry {
                column-count: 1;
            }
            
            .quick-actions {
                flex-direction: column;
            }
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: var(--space-8);
            color: var(--gray-600);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-300);
            border-top-color: var(--red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <a href="/" class="back-button">â† è¿”å›Dashboard</a>
        <div class="page-title">ğŸ’¡ é¡¹ç›®è®°å¿†ç©ºé—´ - TASKFLOW</div>
        <div class="header-actions">
            <button class="btn-primary" onclick="recordADR()">+ è®°å½•</button>
            <button class="btn" onclick="searchMemories()">ğŸ” æœç´¢</button>
        </div>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¿«é€Ÿæ“ä½œæ  -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="recordADR()">ğŸ“‹ è®°å½•ADR</button>
            <button class="quick-action-btn" onclick="recordSolution()">ğŸ› è®°å½•é—®é¢˜æ–¹æ¡ˆ</button>
            <button class="quick-action-btn" onclick="semanticSearch()">ğŸ” è¯­ä¹‰æœç´¢</button>
            <button class="quick-action-btn" onclick="viewRelationGraph()">ğŸ•¸ï¸ å…³ç³»å›¾è°±</button>
        </div>
        
        <!-- ç»Ÿè®¡è„‰æ -->
        <div class="stats-pulse">
            <div class="mini-card">
                <div class="mini-card-value" id="totalMemories">45</div>
                <div class="mini-card-label">ğŸ“š æ¡è®°å¿†</div>
            </div>
            <div class="mini-card">
                <div class="mini-card-value" id="decisionCount">12</div>
                <div class="mini-card-label">ğŸ›ï¸ ä¸ªå†³ç­–</div>
            </div>
            <div class="mini-card">
                <div class="mini-card-value" id="solutionCount">23</div>
                <div class="mini-card-label">ğŸ”§ ä¸ªæ–¹æ¡ˆ</div>
            </div>
            <div class="mini-card">
                <div class="mini-card-value" id="importantCount">8</div>
                <div class="mini-card-label">â­ æ¡é‡è¦</div>
            </div>
        </div>
        
        <!-- ç­›é€‰å¯¼èˆª -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">å…¨éƒ¨</button>
            <button class="filter-tab" data-filter="decision">ğŸ›ï¸ å†³ç­–</button>
            <button class="filter-tab" data-filter="solution">ğŸ”§ æ–¹æ¡ˆ</button>
            <button class="filter-tab" data-filter="architecture">ğŸ“ æ¶æ„</button>
            <button class="filter-tab" data-filter="knowledge">ğŸ’¡ çŸ¥è¯†</button>
            <button class="filter-tab" data-filter="important">â­ é‡è¦</button>
        </div>
        
        <!-- è®°å¿†ç€‘å¸ƒæµ -->
        <div id="memoriesContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div style="margin-top: var(--space-4);">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <script>
        let allMemories = [];
        let currentFilter = 'all';
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¡ è®°å¿†ç©ºé—´å·²åŠ è½½');
            loadMemories();
            setupFilters();
        });
        
        // åŠ è½½è®°å¿†
        async function loadMemories() {
            try {
                const response = await fetch('/api/memories/list?limit=100');
                const data = await response.json();
                
                if (data.success && data.memories) {
                    allMemories = data.memories;
                    renderMemories();
                    updateStats();
                    console.log('âœ… è®°å¿†å·²åŠ è½½:', allMemories.length);
                } else {
                    // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
                    allMemories = [
                        {
                            id: 'MEM-001',
                            type: 'decision',
                            title: 'é‡‡ç”¨Monorepoæ¶æ„',
                            content: 'é¡¹ç›®è§„æ¨¡æ‰©å¤§ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†å¤šä¸ªåŒ…ã€‚å†³å®šä½¿ç”¨pnpm workspaceå®ç°Monorepoæ¶æ„ã€‚',
                            importance: 8,
                            tags: ['architecture', 'monorepo', 'decision'],
                            created_at: '2å¤©å‰',
                            related_count: 3
                        },
                        {
                            id: 'MEM-002',
                            type: 'solution',
                            title: 'è§£å†³Tabåˆ‡æ¢å¤±è´¥é—®é¢˜',
                            content: 'JavaScriptæ¨¡æ¿å­—ç¬¦ä¸²åå¼•å·æœªè½¬ä¹‰å¯¼è‡´è¯­æ³•é”™è¯¯ã€‚åœ¨Python f-stringä¸­æ·»åŠ åæ–œæ è½¬ä¹‰ã€‚',
                            importance: 8,
                            tags: ['bug', 'fix', 'javascript'],
                            created_at: '5å¤©å‰',
                            related_count: 5
                        },
                        {
                            id: 'MEM-003',
                            type: 'knowledge',
                            title: 'React Hooksæœ€ä½³å®è·µ',
                            content: 'useCallbackä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚ä¾èµ–æ•°ç»„éœ€è¦è°¨æ…è®¾ç½®ã€‚',
                            importance: 7,
                            tags: ['react', 'hooks', 'performance'],
                            created_at: '1å‘¨å‰',
                            related_count: 2
                        },
                        {
                            id: 'MEM-004',
                            type: 'decision',
                            title: 'ä½¿ç”¨FastAPIæ„å»ºAPI',
                            content: 'éœ€è¦å¿«é€Ÿå¼€å‘RESTful APIã€‚FastAPIæä¾›è‡ªåŠ¨æ–‡æ¡£ã€ç±»å‹æ£€æŸ¥ã€å¼‚æ­¥æ”¯æŒã€‚',
                            importance: 9,
                            tags: ['api', 'fastapi', 'python'],
                            created_at: '2å‘¨å‰',
                            related_count: 4
                        },
                        {
                            id: 'MEM-005',
                            type: 'solution',
                            title: 'SQLiteå¹¶å‘é”è¡¨è§£å†³',
                            content: 'å¤šä¸ªè¿›ç¨‹åŒæ—¶å†™å…¥å¯¼è‡´database is lockedé”™è¯¯ã€‚ä½¿ç”¨è¿æ¥æ± å’Œé‡è¯•æœºåˆ¶è§£å†³ã€‚',
                            importance: 8,
                            tags: ['database', 'sqlite', 'concurrency'],
                            created_at: '10å¤©å‰',
                            related_count: 3
                        },
                        {
                            id: 'MEM-006',
                            type: 'knowledge',
                            title: 'Dashboardç¼“å­˜ç­–ç•¥',
                            content: 'ä½¿ç”¨ç‰ˆæœ¬å·æ§åˆ¶ç¼“å­˜ï¼ŒService Workeræ³¨å†Œï¼Œmetaæ ‡ç­¾ç¦ç”¨ç¼“å­˜ã€‚',
                            importance: 7,
                            tags: ['cache', 'frontend', 'optimization'],
                            created_at: '1å‘¨å‰',
                            related_count: 2
                        }
                    ];
                    renderMemories();
                    updateStats();
                }
            } catch (error) {
                console.error('âŒ åŠ è½½è®°å¿†å¤±è´¥:', error);
                document.getElementById('memoriesContainer').innerHTML = `
                    <div class="loading">
                        <div style="color: var(--error);">åŠ è½½å¤±è´¥: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        // æ¸²æŸ“è®°å¿†
        function renderMemories() {
            const container = document.getElementById('memoriesContainer');
            
            // è¿‡æ»¤è®°å¿†
            let filtered = allMemories;
            if (currentFilter !== 'all') {
                if (currentFilter === 'important') {
                    filtered = allMemories.filter(m => m.importance >= 8);
                } else {
                    filtered = allMemories.filter(m => m.type === currentFilter);
                }
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div style="font-size: 48px;">ğŸ’¡</div>
                        <div style="margin-top: var(--space-4);">æš‚æ— è®°å¿†</div>
                    </div>
                `;
                return;
            }
            
            const masonry = document.createElement('div');
            masonry.className = 'memories-masonry';
            
            filtered.forEach(memory => {
                const typeClass = memory.type || 'knowledge';
                const card = document.createElement('div');
                card.className = `memory-card ${typeClass}`;
                
                // ç”Ÿæˆæ˜Ÿçº§
                const stars = generateStars(memory.importance);
                
                card.innerHTML = `
                    <div class="memory-header">
                        <div class="memory-icon">${getTypeIcon(memory.type)}</div>
                        <div class="memory-type">${getTypeText(memory.type)}</div>
                    </div>
                    <div class="memory-title">${memory.title}</div>
                    <div class="memory-content">${memory.content}</div>
                    <div class="memory-importance">
                        <div class="star-rating">${stars}</div>
                        <div class="importance-label">é‡è¦æ€§: ${memory.importance}/10</div>
                    </div>
                    <div class="memory-footer">
                        <div class="memory-tags">
                            ${memory.tags ? memory.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        </div>
                        <div class="memory-meta">
                            <span>ğŸ“… ${memory.created_at}</span>
                            <span>ğŸ”— ${memory.related_count}ä¸ªå…³è”</span>
                        </div>
                        <div class="memory-actions">
                            <button class="memory-action-btn" onclick="event.stopPropagation(); viewMemory('${memory.id}')">æŸ¥çœ‹</button>
                            <button class="memory-action-btn" onclick="event.stopPropagation(); viewRelations('${memory.id}')">å…³ç³»</button>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', function() {
                    viewMemory(memory.id);
                });
                
                masonry.appendChild(card);
            });
            
            container.innerHTML = '';
            container.appendChild(masonry);
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalMemories').textContent = allMemories.length;
            document.getElementById('decisionCount').textContent = 
                allMemories.filter(m => m.type === 'decision').length;
            document.getElementById('solutionCount').textContent = 
                allMemories.filter(m => m.type === 'solution').length;
            document.getElementById('importantCount').textContent = 
                allMemories.filter(m => m.importance >= 8).length;
        }
        
        // è®¾ç½®ç­›é€‰å™¨
        function setupFilters() {
            const tabs = document.querySelectorAll('.filter-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    renderMemories();
                    console.log('ç­›é€‰å™¨:', currentFilter);
                });
            });
        }
        
        // ç”Ÿæˆæ˜Ÿçº§
        function generateStars(importance) {
            const starCount = Math.ceil(importance);
            let stars = '';
            for (let i = 0; i < starCount; i++) {
                stars += 'â­';
            }
            return stars;
        }
        
        // è·å–ç±»å‹å›¾æ ‡
        function getTypeIcon(type) {
            const icons = {
                'decision': 'ğŸ›ï¸',
                'solution': 'ğŸ”§',
                'architecture': 'ğŸ“',
                'knowledge': 'ğŸ’¡',
                'problem': 'ğŸ›'
            };
            return icons[type] || 'ğŸ“';
        }
        
        // è·å–ç±»å‹æ–‡å­—
        function getTypeText(type) {
            const texts = {
                'decision': 'ADR',
                'solution': 'æ–¹æ¡ˆ',
                'architecture': 'æ¶æ„',
                'knowledge': 'çŸ¥è¯†',
                'problem': 'é—®é¢˜'
            };
            return texts[type] || type;
        }
        
        // æŸ¥çœ‹è®°å¿†
        function viewMemory(memoryId) {
            console.log('æŸ¥çœ‹è®°å¿†:', memoryId);
            alert('è®°å¿†è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // æŸ¥çœ‹å…³ç³»
        function viewRelations(memoryId) {
            console.log('æŸ¥çœ‹å…³ç³»:', memoryId);
            alert('å…³ç³»å›¾è°±åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // è®°å½•ADR
        function recordADR() {
            window.location.href = '/adr-recorder';
        }
        
        // è®°å½•è§£å†³æ–¹æ¡ˆ
        function recordSolution() {
            alert('é—®é¢˜æ–¹æ¡ˆè®°å½•åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // è¯­ä¹‰æœç´¢
        function semanticSearch() {
            alert('è¯­ä¹‰æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // æŸ¥çœ‹å…³ç³»å›¾è°±
        function viewRelationGraph() {
            window.location.href = '/memory-constellation';
        }
        
        // æœç´¢è®°å¿†
        function searchMemories() {
            const keyword = prompt('è¯·è¾“å…¥æœç´¢å…³é”®è¯:');
            if (keyword) {
                console.log('æœç´¢:', keyword);
                alert('æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
            }
        }
    </script>
</body>
</html>

